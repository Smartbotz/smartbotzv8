FROM nikolaik/python-nodejs:latest

RUN apt update -y
RUN apt upgrade -y
RUN apt-get install -y --no-install-recommends \
  ffmpeg \
  sudo \
  imagemagick
RUN pip install pillow

RUN npm install -g pm2
RUN npm install -g npm@latest
RUN npm i -g ts-node
RUN npm install pm2 -g
ENV PM2_PUBLIC_KEY ollsbb5i4nm52ve
ENV PM2_SECRET_KEY gnr8n1trq3xueon


WORKDIR /usr/src/app
COPY package.json ./
RUN npm install
RUN ls

EXPOSE 3000
COPY . .
RUN npm run build
CMD ["pm2", "start", "dist/src/index.js"]