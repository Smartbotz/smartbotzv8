import { IMessage } from '../Types'
import { ICommand } from '../Types/command'
import { makeSticker, removeBg } from '../Utils'

export let handler: ICommand = async (m: IMessage, { args }): Promise<void | any> => {
  let buffer: Buffer | string
  buffer = m.quoted && m.quoted.isMedia ? await m.quoted.download() : m.isMedia ? await m.download() : 'reply to a sticker or media'
  if (typeof buffer == 'string') return m.reply(buffer)
  try {
    if (args.includes('-removebg' || '-nobg' || '-nobackground')) buffer = await removeBg(buffer)
    const sticker = await makeSticker(buffer, { author: 'jamal', pack: 'squad', circle: args.includes('-circle'), keepScale: args.includes('-crop') ? false : true })
    m.reply(sticker)
  } catch (error) {
    m.reply(error)
  }
}
handler.tags = ['creator']
handler.help = ['sticker'].map((x) => `${x} <reply media>`)
handler.command = /^(sticker|s|stc|stick|stiker)$/i
