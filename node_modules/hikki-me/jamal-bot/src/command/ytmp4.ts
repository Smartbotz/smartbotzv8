import { Youtube } from '../lib/api/youtube'
import { ICommand, IMessage } from '../Types'
import { isUrl } from '../Utils'

export let handler: ICommand = async (m: IMessage, { args, jamal, command }): Promise<any> => {
  let url = isUrl(args.join(' '))
  if (!url) return m.reply('masukan url dengan benar')
  const isLimit = command.includes('mp3' || 'music') ? 80 : 100
  const data = await Youtube.process(url, command.includes('mp3' || 'music') ? 'mp3' : 'mp4')
  const isSize = parseInt(data.fileSize) > isLimit
  if (!data) return m.reply('url bermasalah')
  let text = `*(ðŸ“Œ YOUTUBE ${data.type.toUpperCase()} ðŸ“Œ)*\n\n`
  text += `*ðŸ”– Title:* ${data.title}\n`
  text += `*ðŸ”– Size:* ${data.fileSize}\n`
  text += `*ðŸ”– Quality:* ${data.quality}\n`
  text += `*ðŸ”– Mimetype:* ${data.type}\n`
  if (isSize) text += `*ðŸ”– Link:* ${data.url}\n\n`
  if (isSize) text += `*ðŸ“Œ ${command.includes('mp3' || 'music') ? 'Music' : 'Video'} Melebihi ${isLimit}MB, Mohon Unduh Secara Manual*\n`
  else text += `*ðŸ“Œ ${command.includes('mp3' || 'music') ? 'Music' : 'Video'} Akan Dikirim Dalam Beberapa Detik, Mohon Tunggu...*\n`
  jamal.sendFile(m.chat, data.thumbnail, { caption: text })
  if (!isSize && isLimit == 100) jamal.sendTButton(m.chat, true, '', 'Klik Jika Ingin Mengambil Audio Dari Video', ['AUDIO ðŸŽµ', '.ytmp3 ' + args.join(' ')], null, data.url)
  if (!isSize && isLimit == 80) jamal.sendFile(m.chat, data.url, { caption: text, mimetype: 'audio/mpeg' })
}
handler.help = ['ytmp4', 'ytmp3'].map((x) => `${x} <url youtube>`)
handler.command = /^(ytmp4|ytvid|ytvideo|ytmp3|ytmusic|youtubemusic)$/i
handler.tags = ['downloader']
