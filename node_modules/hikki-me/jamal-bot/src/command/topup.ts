import { inominalFf, IResultPaymet, topUp } from '../lib/api/topup'
import { ICommand, IMessage } from '../Types'

export let handler: ICommand = async (m: IMessage, { args, jamal, command }): Promise<any> => {
  if (command == 'gotopup') {
    const json = (await new topUp().topUpFreeFire({ id: args[1], nominal: Number(args[0]) as inominalFf })) as any
    if (!m.sender.id.startsWith('628')) return m.reply('Maaf, Lu Olang china')
    const getpay = (await new topUp().getPaymentGateway(json as IResultPaymet, m.sender.id.replace('628', '08'))) as any
    let menu = `*( ðŸ”– TOP UP ðŸ”– )*\n\n`
    menu += `*ðŸ”– Nama:* ${json.data.userNameGame}\n`
    menu += `*ðŸ”– Nominal:* ${json.data.item.name}\n`
    menu += `*ðŸ”– Payment:* ${'QRIS'}\n`
    menu += `*ðŸ”– Silahkan Scan QR Code:*\n`
    return jamal.sendFile(m.chat, getpay.data.elisaConfig.qrCode, { caption: menu })
  } else {
    if (!args[0]) return m.reply('Masukan Id free fire anda')
    if (!args[1]) return m.reply('Masukan jumlah topup')
    const jumlah = Number(args[1])
    if (!(jumlah as inominalFf)) return m.reply('Masukan jumlah topup dengan benar\nlist:\n5 Dm\n12 Dm')
    const getUser = await new topUp().topUpFreeFire({ id: args[0], nominal: jumlah as inominalFf })
    if (!getUser) return m.reply('User tidak ditemukan')
    let menu = `*( ðŸ”– TOP UP ðŸ”– )*\n\n`
    menu += `*ðŸ”– Nama:* ${getUser.data.userNameGame}\n`
    menu += `*ðŸ”– Nominal:* ${jumlah}\n`
    menu += `*ðŸ”– Payment:* ${'QRIS'}\n`
    menu += `* Apakah anda yakin ingin top up?\n`
    jamal.sendTWithUrlButton(m.chat, true, menu, getUser.data.userNameGame, ['Website', 'https://hardianto.xyz', 'Setuju â˜‘', `#gotopup ${jumlah} ${args[0]}`], null, 'https://file.hikki.me/uploads/1k17463rqs.mp4')
  }
}
handler.command = /^(topup|topupff|gotopup)$/i
handler.help = ['topup', 'gotopup']
handler.tags = ['top up']
