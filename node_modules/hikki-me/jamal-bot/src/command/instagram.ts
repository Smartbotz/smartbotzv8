import { metaScraper } from '../lib/api/meta-scraper'
import { ICommand, IMessage } from '../Types'
import { isUrl } from '../Utils'

export let handler: ICommand = async (m: IMessage, { args, jamal }): Promise<any> => {
  if (!args[0]) return m.reply('Please provide a url')
  if (!isUrl(args[0])) return m.reply('Please provide a valid url')
  const url = args[0]
  const api = await new metaScraper().grphqlApi(url)
  if (!api) return m.reply('Something went wrong')
  let menu = `*( ðŸ”– INSTAGRAM ðŸ”– )*\n\n`
  menu += `*ðŸ”– Title:* ${api.caption}\n`
  menu += `*ðŸ”– Views:* ${api.views}\n`
  menu += `*ðŸ”– Duration:* ${api.duration}\n`
  menu += `*ðŸ”– Like:* ${api.like}\n`
  menu += `*ðŸ”– Comment:* ${api.comment}\n`
  if (api.music !== '') {
    menu += `*ðŸ”– Music In Video:* ${api.music}\n`
    menu += `*ðŸ”– Music Artist:* ${api.artist}\n`
    menu += `*ðŸ”– Url Music:* ${api.url_mp3}\n`
  }
  menu += `*ðŸ”– Username:* ${api.username}\n`
  menu += `*ðŸ”– FullName:* ${api.full_name}\n`
  jamal.sendTWithUrlButton(m.chat, true, menu, '*Silahkan klik button di bawah sesuai keinginan*', ['ðŸ”– Source', url, 'ðŸ”– HD', api.result[0].url, 'ðŸ”– SD', api.result[1].url, 'ðŸ”– Audio', '.tomp3 ' + api.result[0].url], null, api.thumbnail)
}
handler.tags = ['downloader']
handler.command = /^(ig|instagram)$/i
handler.help = ['instagram'].map((x) => `${x} <url>`)
