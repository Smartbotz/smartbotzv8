import { ITiktok } from '../../Types'
import { expandUrl } from '../../Utils'
import fetch from 'node-fetch'

export class tiktok {
  async getVideo(url1: string): Promise<ITiktok> {
    let url: string
    const rilkah = await expandUrl(url1)
    if (rilkah.includes('t.tiktok.com')) url = await expandUrl(rilkah)
    else url = rilkah
    const rawUrl = `https://tiktok.com/node/share/video/${url.split('/')[3]}/${url.split('/')[5]}`
    const fetc = await fetch(rawUrl, {
      headers: {
        'User-Agent': 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/84.0.4147.105 Safari/537.36 Edg/84.0.522.52',
      },
    })
    const res = await fetc.json()
    const result = res.seoProps
    const test = {
      ...result.metaParams,
      ...res.itemInfo.itemStruct,
    } as ITiktok
    return test
  }
}
