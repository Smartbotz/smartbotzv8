import { spawn } from 'child_process'
import express from 'express'
import * as http from 'http'
const app = express()
const server = http.createServer(app)
const port = process.env.PORT || 3000
function startScript(file: string) {
  try {
    // use spawn run file type
    const child = spawn('node', [file], {
      stdio: 'inherit',
    })
    child.on('error', (err) => {
      console.error(err)
    })
    child.on('exit', (code) => {
      console.log(`child process exited with code ${code}`)
      startScript(file)
    })
  } catch (e) {
    console.error('please npm run build')
  }
}
server.listen(port, () => console.log(`Listening on port ${port}`))
startScript('dist/src/index.js')
